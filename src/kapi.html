<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap');

        body, html {
            height: 100%;
            width: 100%;
            margin: 0;
            display: flex;
            color: #fff;
            background-color: #111111;
            align-items: center;
            justify-content: center;
        }
        .lowbar {
            width: 100%;
            height: 7%;
            position: fixed;
            bottom: 0px;
            background-color: #00000090;
            opacity: 100%;
            backdrop-filter: blur(7px);
            z-index: 2;
            box-shadow: 0px -5px 25px rgb(0, 0, 0);
        }
        .finwrapper {
            width: 100%;
            height: 100%;
            position: fixed;
            overflow: auto;
            display: flex;
            justify-content: center;
        }
        .container {
            position: absolute;
            top: 0px;
            height: auto;
            max-width: 1500px;
            background-color: #161616;
            display: flex;
            align-items: center;
            flex-direction: column;
            align-content: center;
            justify-content: center;
            width: -webkit-fill-available;
        }
        .loginbox {
            position: absolute;
            top: 0px;
            height: auto;
            max-width: 1500px;
            background-color: #161616;
            display: flex;
            align-items: center;
            flex-direction: column;
            align-content: center;
            justify-content: center;
            width: -webkit-fill-available;
        }

        .rectangle {
            width: 100%;
            height: 100%;
        }

        .input-container{
            font-family: "Noto Sans KR", sans-serif;
            position:relative;
            margin-bottom:25px;
            width: 30%;
        }
        .input-container label{
            position:absolute;
            top:0px;
            left:0px;
            font-size:16px;
            color:#fff;	
            transition: all 0.1s ease-in-out;
        }
        .input-container input{ 
        border:0;
        border-bottom:1px solid #555;  
        background:transparent;
        width:100%;
        padding:8px 0 5px 0;
        font-size:16px;
        color:#fff;
        }
        .input-container input:focus{ 
        border:none;	
        outline:none;
        border-bottom:1px solid #e74c3c;	
        }
        .btn{
            color:#fff;
            background-color:#e74c3c;
            outline: none;
            border: 0;
            color: #fff;
            padding:10px 20px;
            text-transform:uppercase;
            margin-top:50px;
            border-radius:2px;
            cursor:pointer;
            position:relative;
        }
        .input-container input:focus ~ label,
        .input-container input:valid ~ label{
            top:-12px;
            font-size:12px;
            
        }

        .rainbow {
            background-image: linear-gradient(to right, red, orange, yellow, green, blue, indigo, purple);
        }

        .pimage {
            width: 12%;
            min-width: 65px;
            padding-bottom: 10%;
            overflow: hidden;
            position: relative;
            border-radius: 20px;
            margin: 1%;
            margin-top: 2%;
        }

        .pimage img {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 50%;
            left: 50%;
            object-fit: cover;
            transform: translate(-50%, -50%);
        }
        .profileholder {
            display: inline-block;
            margin: 2%;
            margin-top: 1%;
        }
        .masterholder {
            background-color: #202020;
            border-radius: 30px;
            margin: 3%;
        }
        .contentholder {
            align-content: flex-start;
            align-items: flex-start;
        }
        .reactholder {
            display: flex;
            width: 100%;
            flex-direction: row;
            margin-left: 2%;
        }
        .media_holder {
            position: relative;
            max-width: 100%; 
            margin: 2%;
        }
        .media_holder img {
            width: auto;
            max-height: 900px;
            display: block;
            margin: auto;
            max-width: inherit;
        }
        .media_holder video {
            width: auto;
            max-height: 900px;
            display: block;
            margin: auto;
            max-width: inherit;
        }
        .media_btn {
            opacity: 50%;
            position: absolute;
            vertical-align: middle;
            top: 45%;
            font-size: 30px;
            cursor: pointer;
        }
        .urlstr {
            font-family: "Noto Sans KR", sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-style: normal;
            font-size: 20px;
            white-space: pre-wrap;
            word-wrap: break-word;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 50%;
            text-align: center;
            font-size: 20px;
            z-index: 1;
        }

        .hashtag {
            color: #0f0;
        }
        .hr {
            margin: 10px 0;
            border: 0;
            border-top: 1px solid #bbb;
        }
        .xtitle {
            font-family: "Noto Sans KR", sans-serif;
            font-optical-sizing: auto;
            font-weight: 900;
            font-style: normal;
        }
        .groupBox {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
        }
        .menubtn {
            margin: 2px;
            height: 30px;
        }
        .pname {
            font-family: "Noto Sans KR", sans-serif;
            font-optical-sizing: auto;
            font-weight: 700;
            font-style: normal;
            font-size: 25px;
        }
        .pid {
            font-family: "Noto Sans KR", sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-style: normal;
            font-size: 15px;
            opacity: 50%;
            margin: 1px;
        }
        .pcontent {
            font-family: "Noto Sans KR", sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-style: normal;
            font-size: 20px;
            margin: 2%;
            margin-top: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .ovrwrap {
            margin-top: 15px;
        }
    </style>
    <title>ZTR beta</title>
</head>
<body>
    <div class="lowbar"></div>
    <div class="rainbow" style="height: 0.2%;width: 100%;position: fixed;top: 0px;z-index: 2;"></div>
    <div class="finwrapper">
        <div class="container">
        </div>
        <div class="loginbox">
            <img src="https://raw.githubusercontent.com/Kelrit402/ZTR/1538bdc546f2c88d698ba54b47370306750c1062/ztr.png" style="width: 30%; margin-top: 10%; margin-bottom: 10%;">
            <div class="input-container">
                <input type="text" id="uid" required=""/>
                <label>email</label>
            </div>
            <div class="input-container">
                <input type="password" id="upw" required=""/>
                <label>pw</label>
            </div>
            <button type="button" class="btn" onclick="login()">로그인</button>
        </div>
    </div>

    <script>
        var mserver = "http://ec2-43-203-221-155.ap-northeast-2.compute.amazonaws.com:5000"; 
        var g_cookie = ""
        var g_stopautoload = false
        function login(){
            sendreq("","login",JSON.stringify([document.getElementById("uid").value,document.getElementById("upw").value]),"", function (error, response) {
                    if (!error) {
                        g_cookie = response
                        console.log("login successss")
                        gettimeline()
                    }else{
                        alert(error)
                    }
                });
        }

        function gentime() {
            var timeStampInMs = window.performance && window.performance.now && window.performance.timing && window.performance.timing.navigationStart ? window.performance.now() + window.performance.timing.navigationStart : Date.now();
            return timeStampInMs.toString().replace('.', '')
        }

        function timetostr(time) {
            var date = new Date(time);

            var year = date.getFullYear();
            var month = (date.getMonth() + 1).toString().padStart(2, '0'); 
            var day = date.getDate().toString().padStart(2, '0'); 
            var hours = date.getHours().toString().padStart(2, '0'); 
            var minutes = date.getMinutes().toString().padStart(2, '0'); 
            var seconds = date.getSeconds().toString().padStart(2, '0'); 

            var formattedDate = year + "." + month + "." + day + "-" + hours + ":" + minutes + ":" + seconds;
            return formattedDate;
        }

        function truncateString(str) {
            var maxLength = 300
            var maxLines = 6
            if (str.length > maxLength || str.split('\n').length > maxLines) {
                str = str.split('\n').slice(0, maxLines).join('\n');
                str = str.slice(0, maxLength - 3) + '...';
            }
            return str;
        }

        function ctntohtml(arr){
            rtml = ''
            for (var i = 0; i < arr.length; i++){
                if (arr[i].type == 'text'){
                    rtml = rtml + arr[i].text
                }
                if (arr[i].type == 'hashtag'){
                    rtml = rtml + '<span class="hashtag">' + arr[i].text + '</span>'
                }
                if (arr[i].type == 'profile'){
                    rtml = rtml + '<mark>' + arr[i].text + '</mark>'
                }
            }
            return rtml
        }

        function showprofile(contents,uid) {
            document.getElementById('overlay').style.display = 'flex';
            var holder = document.getElementById('ovrwrapper')
            var pname = document.createElement('a')
            pname.setAttribute('class',"pname")
            pname.innerText = contents
            holder.appendChild(pname)
            holder.appendChild(document.createElement('hr'))
            var profilelink = document.createElement('button')
            profilelink.setAttribute('class','menubtn')
            profilelink.setAttribute('onclick',"window.open('https://story.kakao.com/" +uid+ "')")
            profilelink.innerText = 'visit profile'
            holder.appendChild(profilelink)
            var profilelink = document.createElement('button')
            profilelink.setAttribute('class','menubtn')
            profilelink.setAttribute('onclick',"editpanel('" +uid+ "')")
            profilelink.innerText = 'status edit'
            holder.appendChild(profilelink)
        }

        function refreshlabel(){
            ckbox = document.getElementById('addval')
            valuestr = document.getElementById('editval')
            prevlabel = document.getElementById('prevlabel')
            if (ckbox.checked) {
                sendingpkt.padd = true
            }else{
                sendingpkt.padd = false
            }
            sendingpkt.pval = valuestr.value 
            prevlabel.textContent = sendingpkt.puid + " " + sendingpkt.pkey + " " + sendingpkt.pval + " " + sendingpkt.padd
        }

        function editpanel(uid){
            sendingpkt.puid = uid

            var holder = document.getElementById('ovrwrapper')
            holder.innerHTML = ''
            var namewrap = document.createElement('label');
            namewrap.setAttribute('class','pname')
            namewrap.textContent = uid
            holder.appendChild(namewrap)
            holder.appendChild(document.createElement('br'))

            var valuestr = document.createElement('input');
            valuestr.type = 'text'
            valuestr.placeholder = 'value to edit'
            valuestr.id = 'editval'
            holder.appendChild(valuestr)

            var ckbox = document.createElement('input');
            ckbox.type = 'checkbox';
            ckbox.id = 'addval';
            holder.appendChild(ckbox)

            var strs = document.createElement('label');
            strs.htmlFor = 'addval';
            strs.textContent = 'add';
            holder.appendChild(strs)

            holder.appendChild(document.createElement('hr'))

            var btn1 = document.createElement('button')
            btn1.setAttribute('class','menubtn')
            btn1.setAttribute('onclick',"sendingpkt.pkey='point';refreshlabel()")
            btn1.innerText = 'point'

            var btn2 = document.createElement('button')
            btn2.setAttribute('class','menubtn')
            btn2.setAttribute('onclick',"sendingpkt.pkey='warn';refreshlabel()")
            btn2.innerText = 'warning'

            var btn3 = document.createElement('button')
            btn3.setAttribute('class','menubtn')
            btn3.setAttribute('onclick',"sendingpkt.pkey='vip';refreshlabel()")
            btn3.innerText = 'vip'

            var btn4 = document.createElement('button')
            btn4.setAttribute('class','menubtn')
            btn4.setAttribute('onclick',"sendingpkt.pkey='bethac';refreshlabel()")
            btn4.innerText = 'bethac'

            var btn5 = document.createElement('button')
            btn5.setAttribute('class','menubtn')
            btn5.setAttribute('onclick',"sendingpkt.pkey='rekhac';refreshlabel()")
            btn5.innerText = 'rekhac'

            var prevlabel = document.createElement('label');
            prevlabel.setAttribute('class',"pcontent")
            prevlabel.setAttribute('id',"prevlabel")
            prevlabel.textContent = ""

            var btn6 = document.createElement('button')
            btn6.setAttribute('class','menubtn')
            btn6.setAttribute('onclick',"useredit()")
            btn6.innerText = 'send edit data'

            var btn7 = document.createElement('button')
            btn7.setAttribute('class','menubtn')
            btn7.setAttribute('onclick',"remfriend('"+uid+"')")
            btn7.innerText = 'remove friend'

            var btn8 = document.createElement('button')
            btn8.setAttribute('class','menubtn')
            btn8.setAttribute('onclick',"remdata('"+uid+"')")
            btn8.innerText = 'remove data'
            
            holder.appendChild(btn1)
            holder.appendChild(btn2)
            holder.appendChild(document.createElement('br'))
            holder.appendChild(btn3)
            holder.appendChild(btn4)
            holder.appendChild(btn5)
            holder.appendChild(document.createElement('br'))
            holder.appendChild(prevlabel)
            holder.appendChild(document.createElement('br'))
            holder.appendChild(btn6)
            holder.appendChild(document.createElement('hr'))
            holder.appendChild(btn7)
            holder.appendChild(btn8)
        }

        function largeview(fdata,idnum){
            var master = document.createElement('div')
            master.setAttribute('class',"masterholder")
            master.setAttribute('sid',fdata.sid)
            master.setAttribute('onclick', 'getcontents("'+fdata.sid+'")')
            //mainctn.appendChild(master)

            var holder = document.createElement('div')
            holder.setAttribute('id',"fd"+idnum)
            holder.setAttribute('class',"contentholder")
            master.appendChild(holder)

            var pholder = document.createElement('div')
            pholder.setAttribute('class',"profileholder")
            holder.appendChild(pholder)
            pholder.style.marginLeft = "10px"
            pholder.style.display = "flex"
            pholder.innerHTML = '<div class="pimage"></div><div style="width: 100%;margin: 2%;"></div>'

            var pimg = document.createElement('img')
            pimg.setAttribute('src',fdata.actor.profile_image_url)
            pholder.childNodes[0].appendChild(pimg)

            var pname = document.createElement('a')
            pname.setAttribute('class',"pname")
            pname.textContent = fdata.actor.display_name
            pholder.childNodes[1].appendChild(pname)

            var pid = document.createElement('pre')
            pid.setAttribute('class',"pid")
            pid.textContent = timetostr(fdata.updated_at)
            pholder.childNodes[1].appendChild(pid)

            var pcnt = document.createElement('pre')
            pcnt.setAttribute('class',"pcontent")
            pcnt.innerHTML = truncateString(ctntohtml(fdata.content_decorators))
            holder.appendChild(pcnt)

            if (fdata.media_type == "image") {
                var mdhldr = document.createElement('div')
                mdhldr.setAttribute('class','media_holder')
                mdhldr.setAttribute('id','md'+idnum)
                mdhldr.setAttribute('pg',0)
                holder.appendChild(mdhldr)
                if (fdata.media.length != 1) {
                    mdhldr.innerHTML = mdhldr.innerHTML + `<p class="media_btn" style="right: 0%;" onclick="pagemedia('md`+idnum+`',1,event)">⩾</p><p class="media_btn" style="display: none; left: 0%;" onclick="pagemedia('md`+idnum+`',-1,event)">⩽</p>`
                }
                for (var u = 0; u < fdata.media.length; u++){
                    if (u==0){
                        mdhldr.innerHTML = mdhldr.innerHTML + '<img src="'+fdata.media[u].origin_url+'" style="display: block;" getcontents("'+fdata.sid+'")>'
                    }else{
                        mdhldr.innerHTML = mdhldr.innerHTML + '<img src="'+fdata.media[u].origin_url+'" style="display: none;" getcontents("'+fdata.sid+'")>'
                    }
                }
            }
            if (fdata.media_type == "video") {
                var mdhldr = document.createElement('div')
                mdhldr.setAttribute('class','media_holder')
                mdhldr.setAttribute('id','md'+idnum)
                mdhldr.setAttribute('pg',0)
                holder.appendChild(mdhldr)
                if (fdata.media.length != 1) {
                    mdhldr.innerHTML = mdhldr.innerHTML + `<p class="media_btn" style="right: 0%; width: 100%;" onclick="pagemedia('md`+idnum+`',1,event)">⩾</p><p class="media_btn" style="display: none; left: 0%;" onclick="pagemedia('md`+idnum+`',-1,event)">⩽</p>`
                }
                for (var u = 0; u < fdata.media.length; u++){
                    if (u==0){
                        mdhldr.innerHTML = mdhldr.innerHTML + '<video src="'+fdata.media[u].url_hq+'" type="video/mp4" style="display: block;" controls></video>'
                    }else{
                        mdhldr.innerHTML = mdhldr.innerHTML + '<video src="'+fdata.media[u].url_hq+'" type="video/mp4" style="display: none;" controls></video>'
                    }
                }
            }
            if (fdata.media_type == "scrap") {
                var mdhldr = document.createElement('div')
                mdhldr.setAttribute('class','media_holder')
                mdhldr.setAttribute('id','md'+idnum)
                mdhldr.setAttribute('pg',0)
                mdhldr.setAttribute('onclick',"window.open('" +fdata.scrap.requested_url+ "')")
                holder.appendChild(mdhldr)
                mdhldr.innerHTML = '<pre class="urlstr">'+fdata.scrap.title+'\n'+fdata.scrap.site_name+'</pre>'
                mdhldr.innerHTML = mdhldr.innerHTML + '<img src="'+fdata.scrap.image[0]+'" style="opacity: 40%;border-radius: 30px;">'
            }
            if (fdata.verb == 'share'){
                var vshare = largeview(fdata.object,'_s'+idnum,)
                holder.appendChild(vshare)
                vshare.style = 'border: 2px dashed #454545; border-radius: 20px;'
            }

            var rholder = document.createElement('div')
            rholder.setAttribute('id',"rd"+idnum)
            rholder.setAttribute('class',"reactholder")
            master.appendChild(rholder)
            rholder.innerHTML = `<span class="dd" style="height: 50px;width: 10%;min-width: 54px;margin: 2px;margin-bottom: 1%;display: block;text-align: center;line-height: 50px;"></span>
                <span class="dd" style="height: 50px;width: 10%;min-width: 54px;margin: 2px;margin-bottom: 1%;display: block;text-align: center;line-height: 50px;"></span>
                <span class="dd" style="height: 50px;width: 10%;min-width: 54px;margin: 2px;margin-bottom: 1%;display: block;text-align: center;line-height: 50px;"></span>`
            rholder.childNodes[0].innerHTML = `<svg fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 30px;vertical-align: middle;" viewBox="0 0 24 24">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.00019C10.2006 3.90317 7.19377 3.2551 4.93923 5.17534C2.68468 7.09558 2.36727 10.3061 4.13778 12.5772C5.60984 14.4654 10.0648 18.4479 11.5249 19.7369C11.6882 19.8811 11.7699 19.9532 11.8652 19.9815C11.9483 20.0062 12.0393 20.0062 12.1225 19.9815C12.2178 19.9532 12.2994 19.8811 12.4628 19.7369C13.9229 18.4479 18.3778 14.4654 19.8499 12.5772C21.6204 10.3061 21.3417 7.07538 19.0484 5.17534C16.7551 3.2753 13.7994 3.90317 12 6.00019Z" stroke="#aaa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
<span class="pcontent" style="vertical-align: middle; color: #aaa;">`+fdata.like_count+'</span>'
            rholder.childNodes[2].innerHTML = `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#aaa" style="width: 30px;vertical-align: middle;">
<path d="M21.0039 12C21.0039 16.9706 16.9745 21 12.0039 21C9.9675 21 3.00463 21 3.00463 21C3.00463 21 4.56382 17.2561 3.93982 16.0008C3.34076 14.7956 3.00391 13.4372 3.00391 12C3.00391 7.02944 7.03334 3 12.0039 3C16.9745 3 21.0039 7.02944 21.0039 12Z" stroke="#aaa" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
<span class="pcontent" style="vertical-align: middle; color: #aaa;">`+fdata.comment_count+'</span>'
            rholder.childNodes[4].innerHTML = `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#aaa" style="width: 30px;vertical-align: middle;">
                <path d="M20 4L12 12M20 4V8.5M20 4H15.5M19 12.5V16.8C19 17.9201 19 18.4802 18.782 18.908C18.5903 19.2843 18.2843 19.5903 17.908 19.782C17.4802 20 16.9201 20 15.8 20H7.2C6.0799 20 5.51984 20 5.09202 19.782C4.71569 19.5903 4.40973 19.2843 4.21799 18.908C4 18.4802 4 17.9201 4 16.8V8.2C4 7.0799 4 6.51984 4.21799 6.09202C4.40973 5.71569 4.71569 5.40973 5.09202 5.21799C5.51984 5 6.07989 5 7.2 5H11.5" stroke="#aaa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
<span class="pcontent" style="vertical-align: middle; color: #aaa;">`+fdata.share_count+'</span>'
            return master
        }

        function showtimeline(feeddata,append = false) {
            if (document.querySelector("body > div.finwrapper > div > div") == undefined) {
                document.querySelector("body > div.finwrapper > div").innerHTML = '<div class="contents" style="height: 100%; width: 100%;"></div>'
            }
            var mainctn = document.querySelector("body > div.finwrapper > div > div")
            if (!append) {
                mainctn.innerHTML = ''
            }
            for (var i = 0; i < feeddata.length; i++){
                if (feeddata[i].verb !== "post" && feeddata[i].verb !== "share") {
                    continue;
                }
                mainctn.appendChild(largeview(feeddata[i],i))
            }
            g_stopautoload = false
        }

        function hugeview(fdata){
            var master = document.createElement('div')
            master.setAttribute('class',"masterholder")
            master.setAttribute('sid',fdata.sid)

            var holder = document.createElement('div')
            holder.setAttribute('id',"fd")
            holder.setAttribute('class',"contentholder")
            master.appendChild(holder)

            var pholder = document.createElement('div')
            pholder.setAttribute('class',"profileholder")
            holder.appendChild(pholder)
            pholder.style.marginLeft = "10px"
            pholder.style.display = "flex"
            pholder.innerHTML = '<div class="pimage"></div><div style="width: 100%;margin: 2%;"></div>'

            var pimg = document.createElement('img')
            pimg.setAttribute('src',fdata.actor.profile_image_url)
            pholder.childNodes[0].appendChild(pimg)

            var pname = document.createElement('a')
            pname.setAttribute('class',"pname")
            pname.setAttribute('onclick',"getprofile('"+fdata.actor.id+"')")
            pname.textContent = fdata.actor.display_name
            pholder.childNodes[1].appendChild(pname)

            var pid = document.createElement('pre')
            pid.setAttribute('class',"pid")
            pid.textContent = timetostr(fdata.updated_at)
            pholder.childNodes[1].appendChild(pid)

            var pcnt = document.createElement('pre')
            pcnt.setAttribute('class',"pcontent")
            pcnt.innerHTML = ctntohtml(fdata.content_decorators)
            holder.appendChild(pcnt)

            if (fdata.media_type == "image") {
                var mdhldr = document.createElement('div')
                mdhldr.setAttribute('class','media_holder')
                mdhldr.setAttribute('id','md')
                mdhldr.setAttribute('pg',0)
                holder.appendChild(mdhldr)
                for (var u = 0; u < fdata.media.length; u++){
                    mdhldr.innerHTML = mdhldr.innerHTML + '<img src="'+fdata.media[u].origin_url+'" style="display: block;max-height: none;width: 100%;">'
                }
            }
            if (fdata.media_type == "video") {
                var mdhldr = document.createElement('div')
                mdhldr.setAttribute('class','media_holder')
                mdhldr.setAttribute('id','md')
                mdhldr.setAttribute('pg',0)
                holder.appendChild(mdhldr)
                for (var u = 0; u < fdata.media.length; u++){
                    mdhldr.innerHTML = mdhldr.innerHTML + '<video src="'+fdata.media[u].url_hq+'" type="video/mp4" style="display: block;max-height: none;width: 100%;" controls></video>'
                }
            }
            if (fdata.media_type == "scrap") {
                var mdhldr = document.createElement('div')
                mdhldr.setAttribute('class','media_holder')
                mdhldr.setAttribute('id','md')
                mdhldr.setAttribute('pg',0)
                mdhldr.setAttribute('onclick',"window.open('" +fdata.scrap.requested_url+ "')")
                holder.appendChild(mdhldr)
                mdhldr.innerHTML = '<pre class="urlstr">'+fdata.scrap.title+'\n'+fdata.scrap.site_name+'</pre>'
                mdhldr.innerHTML = mdhldr.innerHTML + '<img src="'+fdata.scrap.image[0]+'" style="opacity: 40%;border-radius: 30px;">'
            }
            if (fdata.verb == 'share'){
                var vshare = hugeview(fdata.object,'_s')
                holder.appendChild(vshare)
                holder.setAttribute('onclick', 'getcontents("'+fdata.object.sid+'")')
                vshare.style = 'border: 2px dashed #454545; border-radius: 20px;'
            }

            var rholder = document.createElement('div')
            rholder.setAttribute('id',"rd")
            rholder.setAttribute('class',"reactholder")
            master.appendChild(rholder)
            rholder.innerHTML = `<span class="dd" style="height: 50px;width: 10%;min-width: 54px;margin: 2px;margin-bottom: 1%;display: block;text-align: center;line-height: 50px;"></span>
                <span class="dd" style="height: 50px;width: 10%;min-width: 54px;margin: 2px;margin-bottom: 1%;display: block;text-align: center;line-height: 50px;"></span>
                <span class="dd" style="height: 50px;width: 10%;min-width: 54px;margin: 2px;margin-bottom: 1%;display: block;text-align: center;line-height: 50px;"></span>`
            rholder.childNodes[0].innerHTML = `<svg fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 30px;vertical-align: middle;" viewBox="0 0 24 24">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.00019C10.2006 3.90317 7.19377 3.2551 4.93923 5.17534C2.68468 7.09558 2.36727 10.3061 4.13778 12.5772C5.60984 14.4654 10.0648 18.4479 11.5249 19.7369C11.6882 19.8811 11.7699 19.9532 11.8652 19.9815C11.9483 20.0062 12.0393 20.0062 12.1225 19.9815C12.2178 19.9532 12.2994 19.8811 12.4628 19.7369C13.9229 18.4479 18.3778 14.4654 19.8499 12.5772C21.6204 10.3061 21.3417 7.07538 19.0484 5.17534C16.7551 3.2753 13.7994 3.90317 12 6.00019Z" stroke="#aaa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
<span class="pcontent" style="vertical-align: middle; color: #aaa;">`+fdata.like_count+'</span>'
            rholder.childNodes[2].innerHTML = `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#aaa" style="width: 30px;vertical-align: middle;">
<path d="M21.0039 12C21.0039 16.9706 16.9745 21 12.0039 21C9.9675 21 3.00463 21 3.00463 21C3.00463 21 4.56382 17.2561 3.93982 16.0008C3.34076 14.7956 3.00391 13.4372 3.00391 12C3.00391 7.02944 7.03334 3 12.0039 3C16.9745 3 21.0039 7.02944 21.0039 12Z" stroke="#aaa" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
<span class="pcontent" style="vertical-align: middle; color: #aaa;">`+fdata.comment_count+'</span>'
            rholder.childNodes[4].innerHTML = `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#aaa" style="width: 30px;vertical-align: middle;">
                <path d="M20 4L12 12M20 4V8.5M20 4H15.5M19 12.5V16.8C19 17.9201 19 18.4802 18.782 18.908C18.5903 19.2843 18.2843 19.5903 17.908 19.782C17.4802 20 16.9201 20 15.8 20H7.2C6.0799 20 5.51984 20 5.09202 19.782C4.71569 19.5903 4.40973 19.2843 4.21799 18.908C4 18.4802 4 17.9201 4 16.8V8.2C4 7.0799 4 6.51984 4.21799 6.09202C4.40973 5.71569 4.71569 5.40973 5.09202 5.21799C5.51984 5 6.07989 5 7.2 5H11.5" stroke="#aaa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
<span class="pcontent" style="vertical-align: middle; color: #aaa;">`+fdata.share_count+'</span>'
            return master
        }

        function showcontent(cdata) {
            g_stopautoload = true
            if (document.querySelector("body > div > div.contents") == undefined) {
                document.querySelector("body > div.container").innerHTML = '<div class="contents" style="height: 100%; width: 100%;"></div>'
            }
            var mainctn = document.querySelector("body > div > div.contents")
            mainctn.innerHTML = ''
            mainctn.appendChild(hugeview(cdata))
            getcomment(cdata.sid,30,'desc',mainctn)
        }

        function showcomment(fdata,ctn) {
            for (var i = 0; i < fdata.length; i++){
                var master = document.createElement('div')
                master.setAttribute('class',"masterholder")
                master.setAttribute('sid',fdata[i].id)
                master.style.background = 'none'

                var holder = document.createElement('div')
                holder.setAttribute('id',"cd"+i)
                holder.setAttribute('class',"contentholder")
                holder.style.display = 'flex'
                master.appendChild(holder)
                holder.innerHTML = '<div class="pimage"></div>'

                var pimg = document.createElement('img')
                pimg.setAttribute('src',fdata[i].writer.profile_image_url2)
                holder.childNodes[0].appendChild(pimg)

                var pholder = document.createElement('div')
                pholder.setAttribute('class',"profileholder")
                holder.appendChild(pholder)
                pholder.style = "width: 100%;margin-left: 10px;display: inline-block;"

                var pname = document.createElement('a')
                pname.setAttribute('class',"pname")
                pname.textContent = fdata[i].writer.display_name
                pholder.appendChild(pname)

                var pid = document.createElement('pre')
                pid.setAttribute('class',"pid")
                pid.textContent = timetostr(fdata[i].created_at)
                pholder.appendChild(pid)

                var pcnt = document.createElement('pre')
                pcnt.setAttribute('class',"pcontent")
                pcnt.style.marginLeft = '0px'
                pcnt.innerHTML = ctntohtml(fdata[i].decorators)
                pholder.appendChild(pcnt)


                if (fdata[i].media_type == "image") {
                    var mdhldr = document.createElement('div')
                    mdhldr.setAttribute('class','media_holder')
                    mdhldr.setAttribute('id','md')
                    mdhldr.setAttribute('pg',0)
                    holder.appendChild(mdhldr)
                    for (var u = 0; u < fdata[i].media.length; u++){
                        mdhldr.innerHTML = mdhldr.innerHTML + '<img src="'+fdata[i].media[u].origin_url+'" style="display: block;">'
                    }
                }
                ctn.appendChild(master)
            }
        }

        function shownotific(notdata) {
            document.querySelector("#contentsbox").innerHTML = ''
            for (var i = 0; i < notdata.length; i++){
                var master = document.createElement('div')
                master.setAttribute('class',"masterholder")
                document.querySelector("#contentsbox").appendChild(master)

                var holder = document.createElement('div')
                holder.setAttribute('id',"fd"+i)
                holder.setAttribute('class',"contentholder")
                master.appendChild(holder)

                var pimg = document.createElement('img')
                pimg.setAttribute('class',"pimage")
                pimg.setAttribute('src',notdata[i].actor.profile_image_url)
                holder.appendChild(pimg)

                var pholder = document.createElement('div')
                pholder.setAttribute('class',"profileholder")
                holder.appendChild(pholder)
                pholder.style.marginLeft = "10px"
                pholder.style.display = "inline-block"

                var pname = document.createElement('a')
                pname.setAttribute('class',"pname")
                pname.textContent = notdata[i].actor.display_name
                pname.setAttribute('onclick',"getprofile('"+notdata[i].actor.id+"')")
                pholder.appendChild(pname)
                pholder.appendChild(document.createElement('br'))

                var pid = document.createElement('pre')
                pid.setAttribute('class',"pid")
                pid.textContent = notdata[i].actor.id+"\n"+notdata[i].message
                pholder.appendChild(pid)

                var pcnt = document.createElement('pre')
                pcnt.setAttribute('class',"pcontent")
                pcnt.textContent = notdata[i].thumbnail_text+"\n"+notdata[i].content
                pholder.appendChild(pcnt)

                master.appendChild(document.createElement('hr'))
            }
        }

        function showfriends(frddata) {
            document.querySelector("#contentsbox").innerHTML = ''
            for (var i = 0; i < frddata.length; i++){
                var master = document.createElement('div')
                master.setAttribute('class',"masterholder")
                document.querySelector("#contentsbox").appendChild(master)

                var holder = document.createElement('div')
                holder.setAttribute('id',"fd"+i)
                holder.setAttribute('class',"contentholder")
                master.appendChild(holder)

                var pimg = document.createElement('img')
                pimg.setAttribute('class',"pimage")
                pimg.setAttribute('src',frddata[i].profile_image_url)
                holder.appendChild(pimg)

                var pholder = document.createElement('div')
                pholder.setAttribute('class',"profileholder")
                holder.appendChild(pholder)
                pholder.style.marginLeft = "10px"
                pholder.style.display = "inline-block"

                var pname = document.createElement('a')
                pname.setAttribute('class',"pname")
                pname.textContent = frddata[i].display_name
                pname.setAttribute('onclick',"getprofile('"+frddata[i].id+"')")
                pholder.appendChild(pname)
                pholder.appendChild(document.createElement('br'))

                var pid = document.createElement('pre')
                pid.setAttribute('class',"pid")
                pid.textContent = frddata[i].id
                pholder.appendChild(pid)

                var pcnt = document.createElement('pre')
                pcnt.setAttribute('class',"pcontent")
                try {
                    pcnt.textContent = frddata[i].status_objects[0].message
                } catch (error) {
                }
                pholder.appendChild(pcnt)

                master.appendChild(document.createElement('hr'))
            }
        }

        function showds(dsdata) {
            document.querySelector("#contentsbox").innerHTML = ''
            for (var i = 0; i < dsdata.length; i++){
                var master = document.createElement('div')
                master.setAttribute('class',"masterholder")
                document.querySelector("#contentsbox").appendChild(master)

                var holder = document.createElement('div')
                holder.setAttribute('id',"fd"+i)
                holder.setAttribute('class',"contentholder")
                master.appendChild(holder)

                var pname = document.createElement('label')
                pname.setAttribute('class',"pname")
                pname.setAttribute('onclick',"getprofile('"+dsdata[i][1]+"')")
                pname.textContent = "["+i+"] "+dsdata[i][1]
                holder.appendChild(pname)
                holder.appendChild(document.createElement('br'))

                var pcnt = document.createElement('pre')
                pcnt.setAttribute('class',"pcontent")
                pcnt.textContent = dsdata[i][0]
                holder.appendChild(pcnt)

                master.appendChild(document.createElement('hr'))
            }
        }

        function showstatus(stats) {
            document.querySelector("#contentsbox").innerHTML = ''
            var varr = Object.keys(stats)
            for (var i = 0; i < varr.length; i++){
                var holder = document.createElement('div')
                holder.setAttribute('class',"contentholder")
                document.querySelector("#contentsbox").appendChild(holder)
                var nkey = document.createElement('a')
                nkey.setAttribute("class","pname")
                nkey.textContent = varr[i] + ' : '

                var nval = document.createElement('a')
                nval.setAttribute("class","pname")
                nval.textContent = stats[varr[i]]

                holder.appendChild(nkey)
                holder.appendChild(nval)
            }
        }

        function pagemedia(bid,num,event){
            event.stopPropagation()
            xa = document.getElementById(bid).childNodes
            xn = parseInt(document.getElementById(bid).getAttribute('pg'))+2
            if (num == 1 & xa[xn+1] != undefined){
                for (var i = 2; i < xa.length; i++){
                    xa[i].style.display = 'none'
                }
                xa[xn+1].style.display = 'block'
                document.getElementById(bid).setAttribute('pg',xn+1-2)
                xa[1].style.display = 'block'
                if (xa[xn+2] == undefined) {
                    xa[0].style.display = 'none'
                }
            }
            if (num == -1 & xa[xn-1].tagName == 'IMG'){
                for (var i = 2; i < xa.length; i++){
                    xa[i].style.display = 'none'
                }
                xa[xn-1].style.display = 'block'
                document.getElementById(bid).setAttribute('pg',xn-1-2)
                xa[0].style.display = 'block'
                if (xa[xn-2].tagName != 'IMG') {
                    xa[1].style.display = 'none'
                }
            }
        }

        function sendreq(xurl="",xcmd="",xdata="",xcookie="",callback){
            var xhr = new XMLHttpRequest();
            xhr.open("GET", mserver, true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.setRequestHeader("Xurl", xurl);
            xhr.setRequestHeader("Xcmd", xcmd);
            xhr.setRequestHeader("Xdata", xdata);
            xhr.setRequestHeader("Xcookie", xcookie);
            xhr.send();
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    callback(null, xhr.responseText);
                } else {
                    if (xhr.status != 200){
                        callback(new Error('error : ' + xhr.status), null);
                    }
                }
            };
        }

        function prestart() {
            if (confirm("restart bot?")) {
                sendreq('p.restart', function (error, response) {
                    if (!error) {
                        alert(response);
                    }else{
                        alert(error)
                    }
                });
            }
        }

        function filterfrd() {
            if (confirm("filter friends?")) {
                sendreq('remfriends', function (error, response) {
                    if (!error) {

                    }else{
                        alert(error)
                    }
                });
            }
        }

        function useredit() {
            if (confirm("edit user?")) {
                vstr = JSON.stringify(sendingpkt)
                sendreq('set#'+vstr, function (error, response) {
                    if (!error) {
                        alert(response);
                    }else{
                        alert(error)
                    }
                });
            }
        }

        function remfriend(uid) {
            if (confirm("remove friend?")) {
                sendreq('unfrd#'+uid, function (error, response) {
                    if (!error) {
                        alert(response);
                    }else{
                        alert(error)
                    }
                });
            }
        }

        function remdata(uid) {
            if (confirm("remove user data?")) {
                sendreq('remdata#'+uid, function (error, response) {
                    if (!error) {
                        alert(response);
                    }else{
                        alert(error)
                    }
                });
            }
        }

        function getprofile(uid) {
            sendreq('usr#'+uid, function (error, response) {
                if (!error) {
                    showprofile(response,uid)
                }
            });
            
        }

        function getnotific() {
            sendreq('notific', function (error, responseText) {
                if (!error) {
                    recdata = JSON.parse(responseText);
                    shownotific(recdata)
                }
            });
        }

        function getfriends() {
            sendreq('friends', function (error, responseText) {
                if (!error) {
                    recdata = JSON.parse(responseText);
                    showfriends(recdata)
                }
            });
        }

        function getcomment(sid,lpp,order,hobj) {
            sendreq('https://story.kakao.com/a/activities/'+sid+'/comments?lpp='+lpp+'&order='+order+'&_='+gentime(),"get","",g_cookie, function (error, response) {
                if (!error) {
                    recdata = JSON.parse(response);
                    if (recdata[0] != 200) {
                        alert("ERROR! "+recdata[0]);
                    }else{
                        showcomment(JSON.parse(recdata[1]),hobj)
                    }
                }
            });
        }

        function getcontents(sid) {
            sendreq('https://story.kakao.com/a/activities/'+sid+'?from=home&_='+gentime(),"get","",g_cookie, function (error, response) {
                if (!error) {
                    recdata = JSON.parse(response);
                    if (recdata[0] != 200) {
                        alert("ERROR! "+recdata[0]);
                    }else{
                        showcontent(JSON.parse(recdata[1]))
                    }
                }
            });
        }

        function gettimeline() {
            if (document.querySelector("body > div.finwrapper > div.loginbox") != undefined) {
                document.querySelector("body > div.finwrapper > div.loginbox").remove()
            }
            sendreq('https://story.kakao.com/a/feeds?ag=false&_='+gentime(),"get","",g_cookie, function (error, response) {
                if (!error) {
                    recdata = JSON.parse(response);
                    if (recdata[0] != 200) {
                        alert("ERROR! "+recdata[0]);
                    }else{
                        console.log(JSON.parse(recdata[1]).feeds)
                        showtimeline(JSON.parse(recdata[1]).feeds)
                    }
                }
            });
        }

        function moretimeline(sid) {
            sendreq('https://story.kakao.com/a/feeds?ag=false&since='+sid+'&_='+gentime(),"get","",g_cookie, function (error, response) {
                if (!error) {
                    recdata = JSON.parse(response);
                    if (recdata[0] != 200) {
                        console.log(recdata[0])
                    }else{
                        showtimeline(JSON.parse(recdata[1]).feeds,true)
                    }
                }
            });
        }

        function getstatus() {
            sendreq('status', function (error, response) {
                if (!error) {
                    recdata = JSON.parse(response);
                    showstatus(recdata)
                }
            });
        }

        function getds() {
            sendreq('dsmsgs', function (error, response) {
                if (!error) {
                    recdata = JSON.parse(response);
                    showds(recdata)
                }
            });
        }

        function getranks() {
            sendreq('ranks', function (error, response) {
                if (!error) {
                    document.querySelector("#contentsbox").innerHTML = ''
                    var pcnt = document.createElement('pre')
                    pcnt.setAttribute('class',"pcontent")
                    pcnt.textContent = response
                    document.querySelector("#contentsbox").appendChild(pcnt)
                }
            });
        }

        function handleScroll() {
            var totalHeight = document.documentElement.scrollHeight;
            var currentScroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
            var windowHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight || 0;

            if ((currentScroll + windowHeight) / totalHeight >= 0.8 & !g_stopautoload) {
                g_stopautoload = true
                var xa = document.querySelector("body > div.container > div").childNodes
                moretimeline(xa[xa.length-1].getAttribute('sid'))
            }
        }
        window.addEventListener('scroll', handleScroll);
    </script>
</body>
</html>
